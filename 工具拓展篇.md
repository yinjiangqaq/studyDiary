## webpack

https://zhuanlan.zhihu.com/p/28245984

https://www.jianshu.com/p/e80d38661358

### 核心概念

* entry：一个可执行模块或者库的入口。

* chunk：多个文件组成一个代码块。可以将可执行的模块和他所依赖的模块组合成一个 chunk，这是打包。

* loader：文件转换器。例如把 es6 转为 es5，scss 转为 css 等

* plugin：扩展 webpack 功能的插件。在 webpack 构建的生命周期节点上加入扩展 hook，添加功能。

### 各种 loader

* css-loader 是处理 CSS 文件中的 url()等
* style-loader 讲 CSS 插入到页面的 style 标签
* less-loader 是将 less 文件编译成 css
* sass-loader 是将 sass 文件编译成 css

### webpack 的 loader 和 plugin

> webpack 允许我们使用 loader 来处理文件，loader 是一个导出为 function 的 node 模块。可以将匹配到的文件进行一次转换，同时 loader 可以链式传递。loader 可以理解成用来加载某些资源，专注于文件转化。

loader 的使用方式：

1. 在配置文件中 webpack.config.js 中配置

``` js
module.exports = {
    module: {
        rules: [{
            test: /\.txt$/,
            use: "raw-loader",
        }, ],
    },
};
```

2. 通过命令行参数方式：

``` 

webpack --module-bind 'txt=raw-loader'

```

3. 通过内联使用

``` 

import txt from 'raw-loader!./file.txt'
```

### 如何写一个 loader

官网介绍[How to write a loader?](https://webpack.js.org/contribute/writing-a-loader/)

plugins 顾名思义插件的意思，拓展了 webpack 的功能

## require.context 实现前端工程自动化

一个 webpack 的 api, 通过执行 `require.context` 函数获取一个特定的上下文, 主要用来实现自动化导入模块, 在前端工程中, 如果遇到从一个文件夹引入很多模块的情况, 可以使用这个 api, 它会遍历文件夹中的指定文件, 然后自动导入, 使得不需要每次显式的调用 import 导入模块

### 什么情况下用到require.context

也就是当文件夹中的js文件变多时，手动import很麻烦，就可以使用require.context，来实现自动化导入

### 用法

``` js
require.context(directory, useSubdirectories = false, regExp = /^./ / );

// directory {String} -读取文件的路径

// useSubdirectories {Boolean} -是否遍历文件的子目录

// regExp {RegExp} -匹配文件的正则
```

借助webpack官网的例子

``` js
require.context('./test', false, /.test.js$/);
```

执行keys()方法返回了一个由匹配文件的文件名组成的数组

id属性返回了**匹配的文件夹的相对于工程的相对路径**, 是否遍历子目录, 匹配正则组成的字符串

对于resolve方法可以看到它是一个函数接受req参数, 经过实践我发现这个**req参数的值是keys方法返回的数组的元素**, 接着我们传入其中一个元素执行resolve函数

``` js
const files = require.context('.', false, /\.js$/)

files.keys().forEach(key => {
    if (key === './index.js') return
    configRouters = configRouters.concat(files(key).default) //读出文件中的default模块

})

console.dir(files)

console.log('keys', files.keys())

console.log('id:', files.id)

//resolve函数的参数是files.keys()的这个数组中的元素
console.log('resolve:', files.resolve(files.keys()[0]))
```

### 实用场景

require.context另外一个常用的地方是svg图标, 可以不用每次导入图标文件, 相对于以前的iconfont, svg有很多好处强烈推荐, 详情可以看这个

[手把手带你优雅使用icon](https://juejin.cn/post/6844903517564436493)
